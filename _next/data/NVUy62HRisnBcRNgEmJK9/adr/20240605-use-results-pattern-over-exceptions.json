{"pageProps":{"projectName":"SSW Clean Architecture Template","currentAdr":{"slug":"20240605-use-results-pattern-over-exceptions","package":null,"title":"Use Results Pattern Over Exceptions","status":"accepted","supersededBy":null,"tags":["result-pattern","exceptions","<!--","optional:","space","and/or","comma-separated","list","of","tags","-->"],"deciders":["Daniel Mackay","William Liebenberg"],"body":{"enhancedMdx":"\nTechnical Story: https://github.com/SSWConsulting/SSW.CleanArchitecture/issues/242 <!-- optional: description | ticket/issue URL -->\n\n## Context and Problem Statement\n\nUsing exceptions allows us to have global handling for certain types of errors (server error, bad request, not found, etc). They keep our code minimal as we don't need to add specific handling into every API endpoint. However, we still need to ensure these status codes are documented correctly.\n\nThe problem with this approach is that we're using exceptions as flow control. In other words, if a behavior is expected in your application (like a validation error), this is not an exceptional circumstance.\n\nAccording to David Fowler exceptions are [very expensive](https://github.com/dotnet/aspnetcore/issues/46280#issuecomment-1527898867) in ASP.NET Core.\n\nThere are several problems with using exceptions as flow control:\n\n- Performance - Exceptions are also very expensive to throw and catch\n- Breaks Principle of Least Astonishment - It's not obvious what exceptions can be thrown from a method. You need to look deep into the code.\n- Flow Control - Exceptions are complicated goto statements\n- Exception Groups - Exceptions can be grouped into 'expected' and 'unexpected' exceptions. It can be difficult to know which is which.\n\n## Considered Options\n\n1. Use Exceptions for Validation Flow Control\n2. Use Result Pattern for Validation and Flow Control\n\n## Decision Outcome\n\nChosen option: \"Option 2 - Use Result Pattern for Validation and Flow Control\", because exceptions should only be used for exceptional circumstances, and NOT for flow control.\n\n### Consequences <!-- optional -->\n\n- Dependency on additional nuget packages\n\n## Pros and Cons of the Options <!-- optional -->\n\n### Option 1 - Use Exceptions for Validation Flow Control\n\nAs per the current implementation.\n\n- ✅ Simple\n- ✅ Less code\n- ❌ Performance cost\n- ❌ Using exceptions as flow control (expensive 'goto' statements)\n- ❌ Breaks Principle of Least Astonishment\n- ❌ Exception Groups - not obvious which exceptions are expected and which are unexpected\n\n### Option 2 - Use Result Pattern for Validation and Flow Control\n\n- ✅ Improved Performance - no exceptions thrown\n- ✅ Explicit flow control\n- ✅ Adheres to the Principle of Least Astonishment\n- ✅ Exception Groups - it's clear that exceptions are real problems\n- ❌ More verbose code in the minimal API\n- ❌ It's possible to forget to check specific results\n\nThe result pattern could be implemented via:\n\n- [Ardalis.Result](https://github.com/ardalis/Result)\n- [Fluent Results](https://github.com/altmann/FluentResults)\n- [OneOf](https://github.com/mcintyre321/OneOf)\n\n## Links <!-- optional -->\n\n- https://ardalis.com/avoid-using-exceptions-determine-api-status/\n- https://blog.nimblepros.com/blogs/getting-started-with-ardalis-result/\n- https://github.com/ardalis/Result\n- https://www.milanjovanovic.tech/blog/functional-error-handling-in-dotnet-with-the-result-pattern\n- https://www.dandoescode.com/blog/minimal-apis-typed-results-and-open-api\n"},"creationDate":"2024-07-02T09:53:22.000Z","lastEditDate":"2024-07-02T09:53:22.000Z","lastEditAuthor":"Daniel Mackay [SSW]","publicationDate":"2024-06-05T13:59:59.000Z","file":{"relativePath":"docs/adr/20240605-use-results-pattern-over-exceptions.md","absolutePath":"/home/runner/work/SSW.CleanArchitecture/SSW.CleanArchitecture/docs/adr/20240605-use-results-pattern-over-exceptions.md"},"repository":{"provider":"github","viewUrl":"https://github.com/SSWConsulting/SSW.CleanArchitecture/blob/master/docs/adr/20240605-use-results-pattern-over-exceptions.md"}},"l4bVersion":"1.0.1"},"__N_SSG":true}