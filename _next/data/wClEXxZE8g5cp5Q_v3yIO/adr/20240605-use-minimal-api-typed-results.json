{"pageProps":{"projectName":"SSW Clean Architecture Template","currentAdr":{"slug":"20240605-use-minimal-api-typed-results","package":null,"title":"Use Minimal API Typed Results","status":"accepted","supersededBy":null,"tags":["minimal-api","typed-results"],"deciders":["Daniel Mackay","William Liebenberg"],"body":{"enhancedMdx":"\nTechnical Story: https://github.com/SSWConsulting/SSW.CleanArchitecture/issues/137\n\n## Context and Problem Statement\n\nCurrently, our APIs use the `Result` pattern to return a `Result<T>` object. This works OK, but additional metadata is required to determine the status code of the response. We need to add the metadata manually which means there is a chance of inconsistency between the response and the status code.\n\nWe have tried to get around this by using helper methods to create the consistent OpenAI metadata for each REST verb.  This was an improvement, but we still have the problem of the API status codes not being consistent with the response.\n\nFor example:\n\n```csharp\n/// <summary>\n/// Used for POST endpoints that creates a single item.\n/// </summary>\npublic static RouteHandlerBuilder ProducesPost(this RouteHandlerBuilder builder) => builder\n    .Produces(StatusCodes.Status201Created)\n    .ProducesValidationProblem()\n    .ProducesProblem(StatusCodes.Status500InternalServerError);\n```\n\nThe problem here is that we advertise returning a 201, but the API might return a 200.\n\nThis inconsistency, makes integrating with our APIs difficult.\n\n## Considered Options\n\n1. Use Results (current implementation)\n2. Use TypedResults\n\n## Decision Outcome\n\nChosen option: \"Option 2 - Use TypedResults\", because it allows us to guarantee our APIs return what they say they do.\n\n### Consequences <!-- optional -->\n\n- Dependency on additional nuget packages\n\n## Pros and Cons of the Options <!-- optional -->\n\n### Option 1 - Use Results (current implementation)\n\nAs per the current implementation.\n\n- ✅ More concise code\n- ❌ Allows for inconsistencies between the response and the status code\n\nFor example:\n\n```csharp\ngroup\n    .MapPost(\"/{teamId:guid}/heroes/{heroId:guid}\",\n        async (ISender sender, Guid teamId, Guid heroId, CancellationToken ct) =>\n        {\n            var command = new AddHeroToTeamCommand(teamId, heroId);\n            await sender.Send(command, ct);\n            return Results.Ok();\n        })\n    .WithName(\"AddHeroToTeam\")\n    .ProducesPost();\n```\n\n### Option 2 - Use TypedResults\n\n- ✅ Guarantees the response status code matches the response\n- ❌ More verbose code\n\nFor example:\n\n```csharp\ngroup\n    .MapPost(\"/{teamId:guid}/heroes/{heroId:guid}\",\n        async Task<Results<ValidationProblem, NotFound<string>, Created>> (ISender sender, Guid teamId, Guid heroId, CancellationToken ct) =>\n        {\n            var command = new AddHeroToTeamCommand(teamId, heroId);\n            var result = await sender.Send(command, ct);\n\n            if (result.IsInvalid())\n                return TypedResultsExt.ValidationProblem(result);\n\n            if (result.IsNotFound())\n                return TypedResultsExt.NotFound(result);\n\n            return TypedResults.Created();\n        })\n    .WithName(\"AddHeroToTeam\")\n    .ProducesProblem(StatusCodes.Status500InternalServerError);\n```\n\n## Links <!-- optional -->\n\n- https://www.dandoescode.com/blog/minimal-apis-typed-results-and-open-api\n"},"creationDate":"2024-07-02T09:53:22.000Z","lastEditDate":"2024-07-04T22:54:45.000Z","lastEditAuthor":"Gordon Beeming","publicationDate":"2024-06-05T13:59:59.000Z","file":{"relativePath":"docs/adr/20240605-use-minimal-api-typed-results.md","absolutePath":"/home/runner/work/SSW.CleanArchitecture/SSW.CleanArchitecture/docs/adr/20240605-use-minimal-api-typed-results.md"},"repository":{"provider":"github","viewUrl":"https://github.com/SSWConsulting/SSW.CleanArchitecture/blob/master/docs/adr/20240605-use-minimal-api-typed-results.md"}},"l4bVersion":"1.1.0"},"__N_SSG":true}